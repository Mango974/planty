function brfScrollVideoInstance(){if(brfScrollVideoInstances=[],document.querySelector(".brf-scroll-video")){document.querySelectorAll(".brf-scroll-video").forEach((e=>{new BrfScrollVideo(e)}))}}function brfFlipEverything(){gsap.utils.toArray(".brf-flip-wrapper").forEach((e=>{let t=e,r=t.querySelector(".brf-flip-box"),s=t.querySelector(".brf-flip-front"),i=t.querySelector(".brf-flip-back");i.style.height=s.getBoundingClientRect().height+"px";let a=t.getAttribute("data-type"),o=t.getAttribute("data-duration"),n=t.getAttribute("data-delay"),l=t.getAttribute("data-trigger"),c=t.getAttribute("data-oncomplete"),u=t.getAttribute("data-onstart"),d=t.getAttribute("data-onreversecomplete");a=a||"flip",o=o||1,n=n||0,l=l||"hover",c=c?new Function(c):"",u=u?new Function(u):"",d=d?new Function(d):"";const h=gsap.timeline({paused:!0,onStart:function(){"function"==typeof u&&u()},onComplete:function(){"function"==typeof c&&c()},onReverseComplete:function(){bricksIsFrontend||gsap.set(s,{clearProps:!0}),"function"==typeof d&&d()}});switch(gsap.set(t,{transformStyle:"preserve-3d",transformPerspective:1e3}),gsap.set(r,{transformStyle:"preserve-3d",transformOrigin:"50% 50%"}),gsap.set(i,{rotationY:180,rotationZ:180}),a){case"flip":h.to(s,{rotationX:180,duration:o},n),h.to(i,{rotationX:180,duration:o},n);break;case"fade":t.style.overflow="hidden",gsap.set(i,{width:i.getBoundingClientRect().width-1}),gsap.set(i,{rotationX:180}),h.to(s,{opacity:0,duration:o},n),h.to(i,{opacity:1,duration:o},n);break;case"fadeShrink":t.style.overflow="hidden",gsap.set(i,{width:i.getBoundingClientRect().width-1}),gsap.set(i,{rotationX:180}),h.to(s,{scale:.8,opacity:0,duration:o/2},n),h.to(i,{opacity:1,duration:o},n);break;case"fadeUp":t.style.overflow="hidden",gsap.set(i,{rotationX:180,translateY:i.offsetHeight,opacity:0}),h.to(s,{opacity:1,rotationX:180,duration:o},n),h.to(i,{translateY:0,opacity:1,duration:o},n);break;case"overlay":t.style.overflow="hidden",gsap.set(i,{rotationX:180,translateY:i.offsetHeight+50,zIndex:1}),h.to(i,{translateY:0,zIndex:9999999,duration:o,z:1},n);break;case"overlayShrink":t.style.overflow="hidden",gsap.set(i,{rotationX:180,translateY:i.offsetHeight+50,zIndex:1,scale:.9}),h.to(i,{translateY:0,duration:o,z:1},n)}switch(l){case"hover":e.addEventListener("mouseenter",(e=>{h.play()})),e.addEventListener("mouseleave",(e=>{h.reverse()}));break;case"click":e.addEventListener("click",(t=>{e.classList.contains("active")?(h.reverse(),e.classList.remove("active")):(e.classList.add("active"),h.play())}))}}))}async function brfBeforeAndAfter(){for(let e of document.querySelectorAll(".brf-ba-wrapper")){let t=e.getBoundingClientRect().width,r=e.getBoundingClientRect().height;for(let s of e.querySelectorAll("img"))s.classList.remove("bricks-lazy-hidden"),s.getAttribute("data-src")&&s.setAttribute("src",s.getAttribute("data-src")),s.style.width=t+"px",s.style.height=r+"px",s.ondragstart=function(){return!1};let s=e.querySelector(".brf-ba-handle"),i=e.querySelector(".brf-ba-resize"),a=e;["mousedown","touchstart"].forEach((function(t){s.addEventListener(t,(function(t){t.preventDefault(),s.classList.add("draggable"),i.classList.add("resizable");let r=t.pageX?t.pageX:t.touches[0].pageX,o=s.getBoundingClientRect().width,n=s.offsetLeft+o-r,l=a.offsetLeft,c=a.getBoundingClientRect().width;minLeft=l+10,maxLeft=l+c-o-10,["mousemove","touchmove"].forEach((function(t){s.parentNode.addEventListener(t,(function(t){var r=t.pageX?t.pageX:t.touches[0].pageX;leftValue=r+n-o,leftValue<minLeft?leftValue=minLeft:leftValue>maxLeft&&(leftValue=maxLeft),widthValue=100*(leftValue+o/2-l)/c+"%",e.querySelector(".draggable")&&(e.querySelector(".draggable").style.left=widthValue,["mouseup","touchend"].forEach((function(t){e.querySelector(".draggable").addEventListener(t,(function(){this.classList.remove("draggable"),i.classList.remove("resizable")}))}))),e.querySelector(".resizable")&&(e.querySelector(".resizable").style.width=widthValue)}))})),s.parentNode.addEventListener("mouseup",(function(e){s.classList.remove("draggable"),i.classList.remove("resizable")})),s.parentNode.addEventListener("touchend",(function(e){s.classList.remove("draggable"),i.classList.remove("resizable")}))}))}))}}function brfMegaMenu(){if("undefined"==typeof MegaMenuSettings)return void console.warn("Bricksforge Mega Menu Warning: No Mega Menu data found.");let e=!!MegaMenuSettings&&MegaMenuSettings.data,t=MegaMenuSettings.headerData;if(!t||!t.length)return;let r=t.find((e=>"nav-menu"==e.name&&void 0!==e.settings.activateMegaMenu&&document.querySelector("#brxe-"+e.id))),s=r.settings,i=!!s.activateMegaMenu&&s.activateMegaMenu,a=!!s.menu&&s.menu,o=s.megaMenuTrigger?s.megaMenuTrigger:"hover",n=!!s.megaMenuFullWidth&&s.megaMenuFullWidth,l=s.megaMenuTopSpacing?s.megaMenuTopSpacing:0,c=s.megaMenuCloseSelector?s.megaMenuCloseSelector:"main",u=s.megaMenuCloseEvent?s.megaMenuCloseEvent:"click",d=!!s.megaMenuCloseWhenLeavingNavItem&&s.megaMenuCloseWhenLeavingNavItem,h=s.megaMenuAnimationDuration?s.megaMenuAnimationDuration:150;if(!1===i)return void console.warn("Bricksforge Mega Menu Warning: The Mega Menu is not active.");if(!1===a)return void console.warn('Bricksforge Mega Menu Warning: You have to define a menu for the Nav Item element to use the mega menu. You find the control under: "Select Nav Menu".');if(!document.querySelector("header#brx-header"))return void console.warn("Bricksforge Mega Menu Warning: On this page no header seems to exist");let m=(e,t=!1)=>{let r=e.dataset.navItem;document.querySelectorAll(".bricks-nav-menu li").forEach((e=>{e.classList.remove("megamenu-visible")})),r&&(t||document.querySelector(".bricks-nav-menu li#"+r).classList.add("megamenu-visible"))};for(let t of e){let e=document.createElement("template");e.innerHTML=t;let r=e.content.firstChild;n?document.querySelector("header#brx-header").appendChild(r):document.querySelector("header#brx-header .brxe-container").appendChild(r),(r.querySelector(".brxe-tabs-nested")||r.querySelector(".brxe-tabs"))&&bricksTabs(),(r.querySelector(".brxe-accordion-nested")||r.querySelector(".brxe-accordion"))&&bricksAccordion(),(r.querySelector(".brxe-slider-nested")||r.querySelector(".brxe-slider"))&&bricksSplide()}document.querySelectorAll(".bricks-nav-menu-wrapper li.menu-item").forEach((e=>{e.closest(".wpm-mega-menu")||(e.addEventListener("mouseenter",(()=>{if("hover"==o){let e=document.querySelectorAll(".megamenu-open");for(let t of e)m(t,!0),brfFadeOut(t,h)}})),1==d&&(e.addEventListener("mouseleave",(t=>{var r=e.getBoundingClientRect(),s=r.top+r.height;if(t.pageY>=s-2)return;let i=document.querySelectorAll(".megamenu-open");for(let e of i)m(e,!0),brfFadeOut(e,h),e.classList.remove("megamenu-open")})),document.querySelectorAll(".wpm-mega-menu").forEach((e=>{e.addEventListener("mouseleave",(e=>{let t=document.querySelectorAll(".megamenu-open");for(let e of t)m(e,!0),brfFadeOut(e,h),e.classList.remove("megamenu-open")}))}))))})),document.querySelector("#brxe-"+r.id).querySelectorAll(".bricks-nav-menu-wrapper li.menu-item").forEach((e=>{e.addEventListener("click"==o?"click":"mouseenter",(t=>{if(e.closest(".wpm-mega-menu"))return;let r="LI"==t.target.tagName?t.target:t.target.closest("li"),s=document.querySelectorAll(".wpm-mega-menu");for(let e of s){let s=e;if(n?s.style.top=s.closest("header").getBoundingClientRect().height+parseInt(l,10)+"px":(s.style.top=s.closest("header").getBoundingClientRect().height+parseInt(l,10)+"px",t.target.closest(".brxe-container").style.position="relative"),[...r.classList].includes(s.getAttribute("data-nav-item"))){if(t.preventDefault(),s.classList.contains("megamenu-open")&&"click"==o)return m(e,!0),brfFadeOut(e,h),void s.classList.remove("megamenu-open");e.style.opacity=0,m(e),brfFadeIn(e,h),s.classList.add("megamenu-open")}else m(s,!0),brfFadeOut(s,h),s.classList.remove("megamenu-open")}document.querySelector(c)&&document.querySelector(c).addEventListener("click"==u?"click":"mouseenter",(()=>{let e=document.querySelectorAll(".wpm-mega-menu");for(let t of e)0!=t.style.opacity&&"none"!=t.style.display&&(m(t,!0),brfFadeOut(t,h),t.classList.remove("megamenu-open"))}))}))}))}function brfFadeIn(e,t=150){if(0==t)return e.style.display="block",void(e.style.opacity=1);if("undefined"!=typeof gsap)gsap.to(e,{duration:t/1e3,opacity:1,display:"block"});else{e.style.display="block",e.style.opacity=0;let r=null;requestAnimationFrame((function s(i){r||(r=i);let a=i-r,o=a/t;e.style.opacity=Math.min(o,1),a<t&&requestAnimationFrame(s)}))}}function brfFadeOut(e,t=0){if(0==t)return e.style.display="none",void(e.style.opacity=0);if("undefined"!=typeof gsap)gsap.to(e,{duration:t/1e3,opacity:0,display:"none"});else{e.style.opacity=1;let r=null;requestAnimationFrame((function s(i){r||(r=i);let a=i-r,o=1-a/t;e.style.opacity=Math.max(o,0),a<t?requestAnimationFrame(s):e.style.display="none"}))}}function brfToc(){let e=document.querySelector(".brf-toc-content");if(!e)return;if(!bricksIsFrontend)return;if(e.dataset.status&&"hidden"==e.dataset.status)return void document.querySelector("#brf-toc").closest(".brf-toc").remove();let t=document.createDocumentFragment();t.appendChild(e),document.getElementById("brf-toc").appendChild(t),e.style.display="block"}async function brfWaitForBuilder(e=500){return new Promise((async t=>{setTimeout((function(){t()}),e)}))}function brfIsParsable(e){try{JSON.parse(e)}catch(e){return!1}return!0}function brfGetParents(e,t){void 0===t&&(t=document);for(var r=[],s=e.parentNode;s!==t;){var i=s;r.push(i),s=i.parentNode}return r.push(t),r}function brfQuill(){let e=document.querySelectorAll(".brf-rich-text-container");e&&e.forEach((e=>{let t=e.closest(".form-group"),r=t.dataset.theme?t.dataset.theme:"snow",s=t.dataset.placeholder?t.dataset.placeholder:"",i="true"==t.dataset.readonly,a=t.dataset.formats?t.dataset.formats.split(","):["header","bold","italic","underline","link"],o=t.dataset.formatsMce?t.dataset.formatsMce:"undo redo | formatselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",n=!!a.includes("header")&&[1,2,3,4,5,6,!1],l=!!a.includes("orderedList")&&{list:"ordered"},c=!!a.includes("bulletList")&&{list:"bullet"},u=!!a.includes("color")&&{color:[]},d=!!a.includes("background")&&{background:[]},h=!!a.includes("indent")&&{indent:"+1"},m=!!a.includes("outdent")&&{indent:"-1"},f=!!a.includes("align")&&{align:[]},p=!!a.includes("direction")&&{direction:"rtl"},y=!!t.dataset.colors&&t.dataset.colors.split(",");y&&(u&&(u={color:y}),d&&(d={background:y}));let b=[];n&&(b.push([{header:n}]),a.splice(a.indexOf("header"),1)),l&&a.splice(a.indexOf("orderedList"),1),c&&a.splice(a.indexOf("bulletList"),1),u&&a.splice(a.indexOf("color"),1),d&&a.splice(a.indexOf("background"),1),h&&a.splice(a.indexOf("indent"),1),m&&a.splice(a.indexOf("outdent"),1),f&&a.splice(a.indexOf("align"),1),p&&a.splice(a.indexOf("direction"),1);let g=[...a,l,c,u,d,h,m,f,p].filter((e=>!1!==e));if(a&&b.push(g),"wordpress"==r)return void tinymce.init({selector:"#"+e.id,toolbar:o,statusbar:!1,placeholder:s,setup:function(e){e.on("input",(function(){t.querySelector("input[type=hidden]").value=e.getContent()})),e.on("ExecCommand",(function(){t.querySelector("input[type=hidden]").value=e.getContent()}))}});const S=new Quill(e,{modules:{toolbar:b},readOnly:i,placeholder:s,theme:r});S.root.innerHTML&&(t.querySelector("input[type=hidden]").value=S.root.innerHTML),S.on("text-change",(function(){t.querySelector("input[type=hidden]").value=S.root.innerHTML})),bricksIsFrontend||e.closest(".form-group").querySelectorAll(".ql-toolbar").length>1&&e.closest(".form-group").querySelector(".ql-toolbar").remove(),bricksIsFrontend&&(e.style.visibility="visible")}))}function brfProForms(){bricksIsFrontend||BrfProForms.populateControlData()}localFrames=[],document.addEventListener("DOMContentLoaded",(function(){brfScrollVideoInstance()})),window.onload=function(){brfQuill(),bricksIsFrontend&&(document.querySelector(".brf-flip-wrapper")&&brfFlipEverything(),document.querySelector("#brf-toc")&&brfToc(),"undefined"!=typeof MegaMenuSettings&&MegaMenuSettings.megaMenuActivated&&brfMegaMenu()),document.querySelector(".brf-before-and-after")&&brfBeforeAndAfter(),setTimeout((()=>{if(document.querySelector(".brxe-brf-pro-forms")){document.querySelectorAll(".brxe-brf-pro-forms").forEach((e=>{new BrfProForms(e)}))}}),bricksIsFrontend?0:500)},window.addEventListener("resize",(function(){if(document.querySelector(".brf-ba-wrapper"))for(let e of document.querySelectorAll(".brf-ba-wrapper")){let t=e.getBoundingClientRect().width,r=e.getBoundingClientRect().height;for(let s of e.querySelectorAll("img"))s.classList.remove("bricks-lazy-hidden"),s.getAttribute("data-src")&&s.setAttribute("src",s.getAttribute("data-src")),s.style.width=t+"px",s.style.height=r+"px",s.ondragstart=function(){return!1}}}));class BrfProForms{form;structure=[];currentStep=0;hasSummary=!1;hasShowStepsActive=!1;hasClicksAllowed=!1;hasRemoteSteps=!1;hasSubmitConditions=!1;remoteSteps;summary;isSubmitting=!1;currentActiveElement;constructor(e){this.form=e,this.currentActiveElement=null,this.init()}init(){this.buildVars(),this.handleForm(),bricksIsFrontend||this.handleActiveElementChange()}buildVars(){this.hasSummary="true"==this.form.dataset.brfSummary,this.hasShowStepsActive="true"==this.form.dataset.brfShowSteps,this.hasClicksAllowed="true"==this.form.dataset.brfStepAllowClicks,this.hasRemoteSteps=this.checkForRemoteSteps(),this.remoteSteps=document.querySelectorAll(".brf-steps-remote"),this.hasSubmitConditions="true"==this.form.dataset.brfSubmitConditions}handleActiveElementChange(){const e=document.querySelector(".brx-body").__vue_app__.config.globalProperties,t=this;Object.defineProperty(e.$_state,"activeElement",{get(){return t.currentActiveElement},set(e){t.currentActiveElement=e,t.handleActiveElementChange()}}),BrfProForms.populateControlData()}static populateControlData(){const e=document.querySelector(".brx-body").__vue_app__.config.globalProperties,t=window.parent.document.querySelector(".brx-body").__vue_app__.config.globalProperties,r=e.$_state.activeElement;if(r&&r.settings&&r.settings.actions&&r.settings.actions.includes("mailchimp")&&"brf-pro-forms"==r.name){const e=t.bricks.mailchimpLists,s=t.bricks.elements["brf-pro-forms"].controls.mailchimpGroups,i=r.settings.mailchimpList;if(i){const r=structuredClone(s.options);s.options=e[i].groups,JSON.stringify(r)!==JSON.stringify(s.options)&&(t.$_state.rerenderControls=Date.now())}}}checkForRemoteSteps(){if(document.querySelectorAll(".brf-steps-remote").length>0)for(let e=0;e<document.querySelectorAll(".brf-steps-remote").length;e++){let t=document.querySelectorAll(".brf-steps-remote")[e];if(t.dataset.brfFormId==this.form.id)return this.remoteSteps=t,!0}return!1}async handleForm(e){this.setLoading(),await this.buildStructure(),this.loadingSequences(),await this.showOnlyFirstStep(),this.handleVisualSteps(),this.removeLaoding(),this.handleClickActions(),this.handleLiveEventLogic(),this.handleConditionalSubmitLogic(),this.handleCalculationFieldLogic(),this.handleFileInputs(),this.handleSubmit()}setLoading(){}removeLaoding(){this.form.style.visibility="visible"}handleFileInputs(){let e=this.form.querySelectorAll("input[type=file]");for(let t=0;t<e.length;t++){let r=e[t];"true"!=r.dataset.hideImagePreview&&r.addEventListener("change",(e=>{let t=e.target.files[0],s=new FileReader;s.onload=e=>{let t=e.target.result;if(!r.parentNode.querySelector(".brf-field-image-preview")){let e=document.createElement("div");e.classList.add("brf-field-image-preview");let t=document.createElement("img");t.setAttribute("alt","Image Preview"),e.appendChild(t),r.parentNode.insertBefore(e,r.parentNode.querySelector("label.choose-files"))}let s=r.parentNode.querySelector(".brf-field-image-preview").querySelector("img");s&&s.setAttribute("src",t)},s.readAsDataURL(t)}))}}async buildStructure(){let e=[];for(let t=0;t<this.form.children.length;t++){let r=this.form.children[t];r.classList.contains("step")?(this.structure.push(e),e=[]):(t==this.form.children.length-1&&(e.push(r),this.structure.push(e),e=[]),e.push(r))}this.hasSummary&&this.handleSummaryStructure()}handleVisualSteps(){if(!this.hasShowStepsActive&&!this.hasRemoteSteps)return;let e=document.createElement("div");e.classList.add("brf-steps"),e.classList.add("form-group");for(let t=0;t<this.structure.length;t++){let r=document.createElement("span");r.classList.add("brf-step"),r.innerHTML=t+1;let s=this.form.querySelectorAll(".step");if(t>0){if(void 0===s[t-1])continue;r.innerHTML=s[t-1].getAttribute("aria-label")?s[t-1].getAttribute("aria-label"):"Step",r.dataset.index=t}else 0==t&&(this.hasShowStepsActive&&this.form.dataset.brfFirstStep&&(r.innerHTML=this.form.dataset.brfFirstStep,r.dataset.index=t),this.hasRemoteSteps&&(this.remoteSteps=document.querySelector(".brf-steps-remote"),this.remoteSteps.dataset.brfFirstStep&&(r.innerHTML=this.remoteSteps.dataset.brfFirstStep,r.dataset.index=t)));e.appendChild(r)}if(this.hasSummary){let t=document.createElement("span");t.classList.add("brf-step"),t.innerHTML=this.form.dataset.brfSummaryHeadline?this.form.dataset.brfSummaryHeadline:"Summary",t.dataset.index=this.structure.length-1,e.appendChild(t)}e.children[this.currentStep].classList.add("current"),this.hasShowStepsActive&&this.form.append(e),this.checkForRemoteSteps()&&this.remoteSteps.dataset.brfFormId==this.form.id&&this.remoteSteps.append(e.cloneNode(!0))}addClassToCurrentStep(){let e,t;if(this.hasShowStepsActive&&(e=this.form.querySelectorAll(".brf-step")),this.hasRemoteSteps&&(t=this.remoteSteps.querySelectorAll(".brf-step")),e)for(let t=0;t<e.length;t++){let r=e[t];t==this.currentStep?r.classList.add("current"):r.classList.remove("current")}if(t)for(let e=0;e<t.length;e++){let r=t[e];e==this.currentStep?r.classList.add("current"):r.classList.remove("current")}}handleSummaryStructure(){let e=this.structure[this.structure.length-1];for(let t=0;t<e.length;t++){let r=e[t];r.classList.contains("submit-button-wrapper")&&e.splice(t,1),r.classList.contains("submit-button-wrapper")&&e.splice(t,1)}let t=this.buildSummary();this.structure.push([t,this.form.querySelector(".submit-button-wrapper")]);let r=this.form.querySelector(".brf-hcaptcha-wrapper");if(r)for(let e=0;e<this.structure.length;e++){let t=this.structure[e];for(let e=0;e<t.length;e++){t[e].classList.contains("brf-hcaptcha-wrapper")&&(t.splice(e,1),this.structure[this.structure.length-1].push(r))}}}buildSummary(){this.summary=document.createElement("div"),this.summary.id="brf-summary",this.form.querySelector(".submit-button-wrapper").before(this.summary);let e=this.form.querySelector(".brf-hcaptcha-wrapper");return e&&e.before(this.summary),this.summary}refreshSummary(){let e=this.summary;e.innerHTML="";let t=document.createElement("h3");t.classList.add("brf-summary-headline"),t.innerHTML=this.form.dataset.brfSummaryHeadline?this.form.dataset.brfSummaryHeadline:"Summary",e.append(t);for(let t=0;t<this.structure.length;t++){let r=this.structure[t];for(let t=0;t<r.length;t++){let s=r[t];if(s.classList.contains("form-group")){let t=s.querySelector("label"),r=s.querySelector("input");if(r||(r=s.querySelector("textarea")),r||(r=s.querySelector("select")),s.querySelector('input[type="checkbox"]')&&(r=s.querySelector('input[type="checkbox"]:checked')),s.querySelector('input[type="radio"]')&&(r=s.querySelector('input[type="radio"]:checked')),!r)continue;if(!this.form.dataset.brfSummaryEmpty&&!r.value)continue;let i=document.createElement("div");i.classList.add("brf-summary-item");let a=document.createElement("h4");a.innerHTML=t?t.innerHTML:s.querySelector("*").getAttribute("aria-label"),i.append(a);let o=document.createElement("p");o.innerHTML=r.value?r.value:this.form.dataset.brfSummaryEmptyText?this.form.dataset.brfSummaryEmptyText:"Empty",i.append(o),e.append(i)}}}}handleClickActions(){this.form.addEventListener("click",(e=>{e.target.classList.contains("next")&&(e.preventDefault(),this.jumpToNextStep())})),this.form.addEventListener("click",(e=>{e.target.classList.contains("prev")&&(e.preventDefault(),this.jumpToPrevStep())})),this.form.addEventListener("click",(e=>{e.target.classList.contains("summary")&&(e.preventDefault(),this.jumpToNextStep())})),(this.hasClicksAllowed||document.querySelector(".brf-steps-remote"))&&[this.form,this.remoteSteps].forEach((e=>{e.classList.contains("brf-steps-remote")&&!e.dataset.brfStepAllowClicks||"object"==typeof e&&(NodeList.prototype.isPrototypeOf(e)||e.addEventListener("click",(e=>{this.hasRemoteSteps&&!this.isSyncSteps()||e.target.classList.contains("brf-step")&&(e.preventDefault(),this.hasSummary&&e.target.dataset.index==this.structure.length-1&&this.refreshSummary(),this.jumpToStepWithIndex(e.target.dataset.index))})))}))}handleLiveEventLogic(){(this.hasSubmitConditions||this.hasCalculationField())&&this.form.addEventListener("input",(e=>{"INPUT"!=e.target.tagName&&"TEXTAREA"!=e.target.tagName&&"SELECT"!=e.target.tagName||(this.handleConditionalSubmitLogic(),this.handleCalculationFieldLogic())}))}isSyncSteps(){return this.form.id.toLowerCase()==this.remoteSteps.dataset.brfFormId.toLowerCase()}loadingSequences(){this.form.querySelector(".step-progress .next")&&(this.form.querySelector(".step-progress .prev").style.display=0==this.currentStep?"none":"inline-block",this.form.querySelector(".step-progress .next").style.display=this.currentStep==this.structure.length-1?"none":"inline-block")}async showOnlyFirstStep(){return new Promise(((e,t)=>{this.hideAllSteps();for(let e of this.structure[0])e.style.display="flex";e()}))}jumpToNextStep(){if(this.currentStep==this.structure.length-1)return;if(0!=this.validateCurrentStep()){this.hideAllSteps();for(let e of this.structure[this.currentStep+1])e.style.display="flex";this.currentStep=this.currentStep+1,this.refreshPrevAndNextButtons(),this.hasSummary&&this.isLastStep()&&this.refreshSummary(),(this.hasShowStepsActive||this.hasRemoteSteps)&&this.addClassToCurrentStep()}}jumpToPrevStep(){if(0!=this.currentStep){this.hideAllSteps();for(let e of this.structure[this.currentStep-1])e.style.display="flex";this.currentStep=this.currentStep-1,this.refreshPrevAndNextButtons(),(this.hasShowStepsActive||this.hasRemoteSteps)&&this.addClassToCurrentStep()}}jumpToStepWithIndex(e){if(this.currentStep!=e){this.hideAllSteps();for(let t of this.structure[e])t.style.display="flex";this.currentStep=parseInt(e),this.refreshPrevAndNextButtons(),(this.hasShowStepsActive||this.hasRemoteSteps)&&this.addClassToCurrentStep()}}isLastStep(){return this.currentStep==this.structure.length-1}validateCurrentStep(){for(let e of this.structure[this.currentStep]){if(e.querySelector("input")&&(e.querySelector("input").reportValidity(),!e.querySelector("input").checkValidity()))return!1;if(e.querySelector("textarea")&&(e.querySelector("textarea").reportValidity(),!e.querySelector("textarea").checkValidity()))return!1;if(e.querySelector("select")&&(e.querySelector("select").reportValidity(),!e.querySelector("select").checkValidity()))return!1}return!0}refreshPrevAndNextButtons(){this.form.querySelector(".step-progress .prev").style.display=0==this.currentStep?"none":"inline-block",this.form.querySelector(".step-progress .next").style.display=this.currentStep==this.structure.length-1?"none":"inline-block",this.hasSummary&&this.currentStep==this.structure.length-2&&(this.form.querySelector(".step-progress .next").style.display="none")}hideAllSteps(){for(let e of this.structure)for(let t of e)t.classList.contains("step-progress")||(t.style.display="none")}async handleSubmit(){this.form.querySelector("button[type=submit]").addEventListener("click",(async e=>{this.isSubmitting||e.preventDefault();let t=this.form.querySelector('button[type="submit"]');if(!this.isSubmitting&&this.formIsValid()){if(!1===await this.before_form_submit())return}this.submit_form(t),setTimeout((()=>{this.isSubmitting=!1}),1e3)}))}submit_form(e){this.form.dataset.brfDisableReset?this.form.addEventListener("reset",(e=>{e.preventDefault()})):this.form.checkValidity()&&this.form.querySelectorAll(".ql-editor").forEach((e=>{e.innerHTML=""})),this.isSubmitting=!0,e.click()}async getFormData(e=!1,t=null,r=null){let s=new FormData(this.form),i={};for(let[e,t]of s.entries())i[e]=t;let a=this.form.dataset.brfDynamicPostId,o={postId:window.bricksData.postId,formId:this.form.dataset.elementId,formData:i,formFiles:[]};a&&(o.dynamicPostId=a),t&&(o.captchaResult=t),r&&(o.turnstileResult=r);let n=BRFELEMENTS.apiurl+"before_form_submit";if(e&&(n=BRFELEMENTS.apiurl+"form_init"),!e&&this.form.querySelector('input[type="file"]')){let e=new FormData,t=this.form.querySelectorAll('input[type="file"]');for(let r=0;r<t.length;r++){let s=t[r],i=s.files;for(let t=0;t<i.length;t++){let r=i[t];e.append(s.name,r)}}this.form.querySelector("button[type=submit]").classList.add("sending");let r=await fetch(BRFELEMENTS.apiurl+"temporary_upload_file",{method:"POST",headers:{"X-WP-Nonce":BRFELEMENTS.nonce},body:e}),s=await r.json();s&&"string"==typeof s&&o.formFiles.push({name:s,field:this.form.querySelector('input[type="file"]').getAttribute("name").split("form-field-")[1]})}let l=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":BRFELEMENTS.nonce},body:JSON.stringify(o)});return await l.json()}hasCalculationField(){return this.form.querySelector(".calculation-field")}async handleConditionalSubmitLogic(){if(!this.form.dataset.brfSubmitConditions)return;let e=await this.getFormData(!0);if(!e.submitConditions)return;let t=e.relation,r=!1,s=[];for(let t of e.submitConditions){let r;switch(t.condition){case"option":case"post_meta":case"form_field":r=this.startCondition(t.value2,t.data,t.operator,t.dataType),s.push(r);break;case"storage_item":r=this.startCondition(t.value2,window.localStorage.getItem(t.value),t.operator,t.dataType),s.push(r);break;case"submission_count_reached":r=this.startCondition(e.submissionsCount,e.settings.submission_max?e.settings.submission_max:null,!1,!1,!0),s.push(r);break;case"submission_field":r=this.startCondition(t.value2,t.data?t.data[0].value:null,t.operator,t.dataType),s.push(r);break;default:s.push(!1)}}r="and"==t?s.every((e=>1==e)):s.some((e=>1==e)),!0!==r?(e.settings.submitButtonConditionsAlternativeText&&this.resetSubmitButtonText(e.settings.submitButtonText),this.modifySubmitButton({action:"show"})):this.modifySubmitButton({action:e.settings.submitButtonConditionAction,alternativeText:e.settings.submitButtonConditionsAlternativeText?e.settings.submitButtonConditionsAlternativeText:null})}async handleCalculationFieldLogic(){if(!this.hasCalculationField())return;let e=(await this.getFormData(!0)).calculations;if(!e||0==e.length){return this.form.querySelectorAll(".calculation-result").forEach((e=>{e.value=e.closest(".calculation-field").dataset.emptyMessage})),void document.querySelectorAll(".brf-form-calculation-value").forEach((e=>{let t=e.dataset.calculationId,r=document.querySelector(`.calculation-result[name="form-field-${t}"]`).closest(".calculation-field").dataset.emptyMessage;e.innerText=r}))}for(let t of e){let e=this.form.querySelector(`.calculation-result[name=form-field-${t.id}]`);e&&(e.value=t.value);let r=document.querySelectorAll(`.brf-form-calculation-value[data-calculation-id="${t.id}"]`);for(let e of r){let r=this.handleRemotePostCalculation(t.value,e.dataset.calculationOperator,e.dataset.calculationValue,e.dataset.calculationOperator2,e.dataset.calculationValue2,t.hasCurrencyFormat,t.roundValue);e.innerText=r}}}handleRemotePostCalculation(e,t,r,s,i,a=!1,o=!1){if(!t||!r)return e;e=parseFloat(e),r=parseFloat(r);let n=this.performOperation(e,t,r);return s&&i&&(i=parseFloat(i),n=this.performOperation(n,s,i)),o&&(n=Math.round(n)),a&&(n=n.toFixed(2),n=n.replace(/\B(?=(\d{3})+(?!\d))/g,",")),n}performOperation(e,t,r){if(!["add","subtract","multiply","divide"].includes(t))return e;switch(t){case"add":return e+r;case"subtract":return e-r;case"multiply":return e*r;case"divide":return e/r;default:return e}}async resetSubmitButtonText(e){if(e.match(/\{.*\}/)){let t=BRFELEMENTS.apiurl+"render_dynamic_data?_value="+e+"&_post_id="+(this.form.dataset.brfDynamicPostId?Number(this.form.dataset.brfDynamicPostId):null),r=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":BRFELEMENTS.nonce}}),s=await r.json();s&&(e=s)}this.form.querySelector('button[type="submit"] .text').innerHTML=e}modifySubmitButton({action:e=null,alternativeText:t=null}={}){let r=this.form.querySelector('button[type="submit"]'),s="inline-flex";switch(e){case"hide":r.style.display="none";break;case"show":r.style.display=s,r.removeAttribute("disabled");break;case"disabled":r.setAttribute("disabled","disabled"),r.style.display=s,t&&(r.innerHTML=t);break;default:r.style.display="inline-flex"}}startCondition(e,t,r,s="string",i=!1){if(i){return isNaN(e)||(e=parseFloat(e)),isNaN(t)||(t=parseFloat(t)),e>=t}if(!e||!t)return!1;switch("number"==s&&(e=parseFloat(e),t=parseFloat(t)),r){case"==":return e==t;case"!=":return e!=t;case">":return t>e;case"<":return t<e;case">=":return t>=e;case"<=":return t<=e;case"contains":return t.includes(e);case"not_contains":return!t.includes(e);case"starts_with":return t.startsWith(e);case"ends_with":return t.endsWith(e);case"exists":return e&&""!=e;default:return!1}}disableSubmitButton(){this.form.querySelector("button[type=submit]").setAttribute("disabled","disabled")}enableSubmitButton(){this.form.querySelector("button[type=submit]").removeAttribute("disabled")}hideSubmitButton(){this.form.querySelector("button[type=submit]").style.display="none"}showSubmitButton(){this.form.querySelector("button[type=submit]").style.display="inline-block"}formIsValid(){for(let e of this.form.querySelectorAll("[required]"))if(!e.checkValidity())return!1;return!0}async checkForCaptchas(){return new Promise((async(e,t)=>{if(this.form.querySelector(".brf-hcaptcha-wrapper .h-captcha")){const s=this.form.querySelector(".h-captcha iframe").dataset.hcaptchaWidgetId;var r=hcaptcha.getResponse(s);""===r&&t("hCaptcha challenge not completed"),e(r)}else e(!0)}))}async checkForTurnstile(){const e=new FormData(this.form).get("cf-turnstile-response");return e||!1}async before_form_submit(){return new Promise((async(e,t)=>{let r;try{r=await this.checkForCaptchas()}catch(t){e(!1)}if(!r){let t="Please verify that you are not a robot.",r=this.form.querySelector(".brf-hcaptcha-wrapper");return r.dataset.info&&(t=r.dataset.info),this.fireProValidationMessage(t),e(!1),!1}const s=await this.checkForTurnstile(),i=await this.getFormData(!1,r,s);if(null!=i.success&&0==i.success)return i.data.message&&this.fireProValidationMessage(i.data.message),e(!1),!1;await this.handleProValidation(i)||e(!1);for(let e in i)switch(e){case"update_option":this.liveUpdateValue(i[e]),this.handleConditionalSubmitLogicIfNeeded();break;case"update_post_meta":this.liveUpdateValue(i[e]),this.handleConditionalSubmitLogicIfNeeded();case"set_storage_item":this.setStorageItems(i[e]),this.liveUpdateValue(i[e]),this.handleConditionalSubmitLogicIfNeeded()}e(!0)}))}async handleProValidation(e){for(let t in e)if("create_submission"===t)if(e[t]&&e[t].status&&"duplicate"==e[t].status)return this.fireProValidationMessage(e[t].message),!1;return!0}fireProValidationMessage(e){const t=this.form.querySelector(".message.danger");t&&this.form.removeChild(t);const r=document.createElement("div");r.classList.add("message","danger");const s=document.createElement("div");s.classList.add("text"),s.textContent=e,r.appendChild(s),this.form.appendChild(r),r.addEventListener("click",(function(){r.style.display="none"})),setTimeout((function(){r.style.display="none"}),5e3),this.form.querySelector("button[type=submit]").addEventListener("click",(function(){r.style.display="none"}))}handleConditionalSubmitLogicIfNeeded(){this.form.dataset.brfSubmitConditions&&this.handleConditionalSubmitLogic()}liveUpdateValue(e){if("object"==typeof e)for(let t of e)t.selector&&t.live&&null!=document.querySelector(t.selector)&&(this.form.querySelector(t.selector)?this.form.querySelector(t.selector).innerHTML=t.value:document.querySelector(t.selector).innerHTML=t.value)}setStorageItems(e){if("object"==typeof e)for(let t of e)if(t.name)try{let e=window.localStorage.getItem(t.name);switch(t.type){case"replace":window.localStorage.setItem(t.name,t.value);break;case"increment":e?window.localStorage.setItem(t.name,parseInt(e)+1):window.localStorage.setItem(t.name,1);break;case"decrement":e&&window.localStorage.setItem(t.name,parseInt(e)-1);break;case"increment_by_number":e?window.localStorage.setItem(t.name,parseInt(e)+parseInt(t.value)):window.localStorage.setItem(t.name,parseInt(t.value));break;case"decrement_by_number":e&&window.localStorage.setItem(t.name,parseInt(e)-parseInt(t.value));break;case"add_to_array":if(e)if(brfIsParsable(e)&&"object"==typeof JSON.parse(e)){let r=JSON.parse(e);r.push(t.value),window.localStorage.setItem(t.name,JSON.stringify(r))}else window.localStorage.setItem(t.name,JSON.stringify([e,t.value]));else window.localStorage.setItem(t.name,JSON.stringify([t.value]));break;case"remove_from_array":if(e&&brfIsParsable(e)&&"object"==typeof JSON.parse(e)){let r=JSON.parse(e),s=r.indexOf(t.value);s>-1&&r.splice(s,1),window.localStorage.setItem(t.name,JSON.stringify(r))}}}catch(e){console.log(e)}}}var brfScrollVideoInstances=[],brfScrollVideoCurrentInstance=null;class BrfScrollVideo{scrollVideo;data={src:null,transitionSpeed:8,frameThreshold:.1,cover:!1,sticky:!1,full:!0,trackScroll:!0,useWebCodecs:!0,debug:!1};constructor(e){this.scrollVideo=e,this.init()}init(){if(!ScrollyVideo)throw new Error("The Scroll Video Library is not defined");this.buildVars(),this.createInstance()}buildVars(){this.scrollVideo.dataset.src&&(this.data.src=this.scrollVideo.dataset.src),this.scrollVideo.dataset.transitionSpeed&&(this.data.transitionSpeed=this.scrollVideo.dataset.transitionSpeed),this.scrollVideo.dataset.frameThreshold&&(this.data.frameThreshold=this.scrollVideo.dataset.frameThreshold),this.scrollVideo.dataset.cover?this.data.cover=this.scrollVideo.dataset.cover:this.data.cover=!1,this.scrollVideo.dataset.sticky&&1==this.scrollVideo.dataset.sticky?this.data.sticky=this.scrollVideo.dataset.sticky:this.data.sticky=!1,this.scrollVideo.dataset.full?this.data.full=this.scrollVideo.dataset.full:this.data.full=!1,this.scrollVideo.dataset.useWebCodecs?this.data.useWebCodecs=this.scrollVideo.dataset.useWebCodecs:this.data.useWebCodecs=!1,this.scrollVideo.dataset.debug?this.data.debug=this.scrollVideo.dataset.debug:this.data.debug=!1}createInstance(){!bricksIsFrontend&&brfScrollVideoInstances.includes(this.scrollVideo.id)||(brfScrollVideoCurrentInstance=new ScrollyVideo({scrollyVideoContainer:this.scrollVideo,src:this.data.src,transitionSpeed:this.data.transitionSpeed,frameThreshold:this.data.frameThreshold,cover:this.data.cover,sticky:this.data.sticky,full:this.data.full,trackScroll:this.data.trackScroll,useWebCodecs:!!bricksIsFrontend&&this.data.useWebCodecs,debug:this.data.debug}),brfScrollVideoInstances.push(this.scrollVideo.id))}}